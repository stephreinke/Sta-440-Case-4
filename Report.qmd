---
title: "Sta 440 Case 4"
author: "Christina Lee, Steph Reinke"
date: "November 2025"
format: 
  pdf:
    documentclass: article
    geometry: margin=1in
execute: 
  warning: false
  message: false
  echo: false
---

# 1. Background

Root growth in the rice plant is characterized by a distinct rotational motion called circumnutation. Researchers want to better understand this process. Experimental data was collected on the developing roots of two strains of rice plants, one a wild type (WT) variety and the other a mutant (MU) variety that lacks circumnutation. In particular, cell length and position measurements were collected on cells on the inner and outer curves of a sample of roots representing the two genetic strains. The protocol utilized in this study is as follows:

1.  The mid–line on the central slice of a root and its point of maximum curvature are identified

2.  The lengths of the cells on the inner and outer curves of the root slice are measured and recorded for those cells falling in a window around the point of maximum curvature.

This process was repeated on nine WT and eleven MU genotype roots. By understanding the differences in growth based on side and genotype, researchers can gain a better understanding of circumnutation and rice plants.

## Research Questions

Can the physical mechanism behind root circumnutation in the wild type plants be explained by differential patterns of cell growth on opposing sides of the root? Is there evidence that these patterns are diminished in the mutant genotype?

# 2. Data and Frequentist Model

To answer these questions we examined the resulting dataset of the process described above. The dataset contains: length, midline (distance from root tip along midline), root ID ((WT)1-9 \$ (MU)1-11), side (inner or outer), and genotype (wild type (WT) & mutant (MU)) for each observation. We conducted exploratory data analysis to see how length varied by root, side, and genotype. For WT roots, there is a visible difference between inner and outer cell lengths, and this difference varies by root id (Fig 1). For MU roots, the inner and outer cell lengths tend to be similar (Fig 2). A combined analysis showed that inner and outer cell lengths are distributed the same for MU roots, while outer tends to be longer than inner cells for WT roots (Fig 3).

We began with a frequentist nonlinear model to explore if Length varied by side and genotype. Our initial approach used was a seven parameter logistic curve with side and genotype effects. However, after discussion we determined that this model inappropriately assumed a constant midline across roots, which limited its biological realism. To address this issue, we refit the data using a four parameter logistic growth model with root specific random effects. The model estimates cell length (Length) as a function of scaled midline position (M):
$$
\log(\text{Length}) = L + \frac{U - L}{1 + \exp\left(-\frac{\text{M}_{\text{scaled}} - {\text{xmid}}}{s}\right)}
$$

Where:
L: lower asymptote (minimum log Length), U: upper asymptote (maximum log Length), xmid: midpoint (inflection point) of sigmoid curve, s: scale parameter

We included fixed effects for side (inner vs outer) and genotype (WT vs MU), as well as their interaction on U and xmid to test whether growth patterns differ across genotypes and sides of the root. Random effects for xmid and s were included at the root level to allow for root specific inflection points and slopes, accounting for biological variability in growth. Because residual plots from earlier indicated heteroskedasticity we log transformed our response variable (Length) to improve model fit. 

The model was fit using the nlme package in R. Convergence was achieved by extending the max iterations to 200. Residuals versus fitted values by genotype, side, and root do not show any systematic structure (Fig 4-7). The QQ plot of the residuals followed the diagonal line suggesting that normality was met (Fig 8). The predicted curves by side (outer vs inner) were plotted against the data, which showed goodness of fit. No visible difference could be seen between the two MU curves, but the outer curve had consistently larger lengths for the WT (FIG 9 & 10). The key parameters are the side and genotype interaction terms for U and xmid. The estimated coefficient for the interaction between side, genotype and U was negative, but not statistically significant (p-value of 0.5603) (TABLE 1). The estimated coefficient for the interaction between side, genotype, and xmid was negative and statistically significant (p-value of <0.001) (TABLE 1). This suggests that for WT roots the inflection point occurs closer to the root base on the outer side compared to the inner side and compared to MU roots. Thus supporting differential patterns of cell growth by side and genotype. 

```{r}
#| label: read_data_and_EDA

library(tidyverse)
library(knitr)
load("rootData.RData")
plot_1 <- rootData |>
  filter(Genotype == "WT") |>
  ggplot(aes(x = Midline, y = Length, color = side)) +
    geom_point(alpha = 0.005) + 
    geom_smooth(method = "loess", se = FALSE) +
    facet_wrap(~ root, scales = "free_x") +
    theme_bw() +
    labs(title = "Cell Length Along the Root Midline for Wild Type",
         x = "Distance along root (µm)",
         y = "Cell length (µm)",
         color = "Side of Root") +
  scale_color_manual(values = c("Inner" = "coral", "Outer" = "darkseagreen"))


plot_2 <- rootData |>
  filter(Genotype == "MU") |>
  ggplot(aes(x = Midline, y = Length, color = side)) +
    geom_point(alpha = 0.005) + 
    geom_smooth(method = "loess", se = FALSE) +
    facet_wrap(~ root, scales = "free_x") +
    theme_bw() +
    labs(title = "Cell Length Along the Root Midline for Mutant Type",
         x = "Distance along root (µm)",
         y = "Cell length (µm)",
         color = "Side of Root") +
  scale_color_manual(values = c("Inner" = "coral", "Outer" = "darkseagreen"))

plot_3 <- ggplot(rootData, aes(x = side, y = Length, fill = side)) +
  geom_boxplot() +
  facet_wrap(~ Genotype) +
  theme_bw() +
  labs(title = "Distribution of Cell Lengths by Genotype and Side",
       x = "Root Side",
       y = "Cell Length (µm)",
       fill = "Side") +
  scale_fill_manual(values = c("Inner" = "coral", "Outer" = "darkseagreen"))


# GOOD MODEL
library(nlme)
library(ggplot2)
library(dplyr)
# Scale the predictor and ensure factors
rootData <- rootData %>%
  mutate(root = factor(root),
         side = factor(side),
         Genotype = factor(Genotype)) %>%
  group_by(root) %>%
  mutate(Midline_scaled = (Midline - min(Midline)) / (max(Midline) - min(Midline))) %>%
  ungroup()

nlme_model <- nlme(
  log(Length) ~ L + (U - L) / (1 + exp(-(Midline_scaled - xmid) / s)),
  data = rootData,
  fixed = list(L ~ 1, 
               U ~ side * Genotype, 
               xmid ~ side * Genotype, 
               s ~ 1),
  random = xmid + s ~ 1 | root,
  start = c(2,           # L intercept
            2.5, 0, 0, 0,  # U: Intercept, side, Genotype, side:Genotype
            0.5, 0, 0, 0,  # xmid: Intercept, side, Genotype, side:Genotype
            0.1),          # s intercept
  control = nlmeControl(maxIter = 200, msMaxIter = 200)
)

# Plot fitted vs observed (back-transform predictions for plotting)
rootData$predicted <- exp(predict(nlme_model))

# Separate plots for WT and MU for better visibility
wt_data <- filter(rootData, Genotype == "WT") %>% 
  mutate(root = droplevels(root))

p_wt <- ggplot(wt_data, aes(x = Midline_scaled, y = Length, color = side)) +
  geom_point(alpha = 0.4, size = 2) + 
  geom_line(aes(y = predicted), linewidth = 1.2) +
  facet_wrap(~ root, ncol = 3) +
  scale_color_manual(values = c("Inner" = "#E41A1C", "Outer" = "#377EB8")) +
  theme_bw(base_size = 12) +
  labs(title = "Wild Type (WT) Roots", x = "Scaled Midline Position", y = "Cell Length")

mu_data <- filter(rootData, Genotype == "MU") %>% 
  mutate(root = droplevels(root))

p_mu <- ggplot(mu_data, aes(x = Midline_scaled, y = Length, color = side)) +
  geom_point(alpha = 0.4, size = 2) +
  geom_line(aes(y = predicted), linewidth = 1.2) +
  facet_wrap(~ root, ncol = 3) +
  scale_color_manual(values = c("Inner" = "#E41A1C", "Outer" = "#377EB8")) +
  theme_bw(base_size = 12) +
  labs(title = "Mutant (MU) Roots", x = "Scaled Midline Position", y = "Cell Length")

# Residual plots
par(mfrow = c(3, 2))

# By root
p2 <- plot(nlme_model, resid(., type = "p") ~ fitted(.) | root, 
     main = "Residuals by Root", layout = c(6, 3))

# By genotype
p3 <- plot(nlme_model, resid(., type = "p") ~ fitted(.) | Genotype,
     main = "Residuals by Genotype")

# By side
p4 <- plot(nlme_model, resid(., type = "p") ~ fitted(.) | side,
     main = "Residuals by Side")

# Overall
p5 <- plot(nlme_model, resid(., type = "p") ~ fitted(.),
     main = "Residuals vs Fitted")

# Q-Q plot
p6 <- qqnorm(nlme_model, ~ resid(., type = "p"), main = "Normal Q-Q Plot")

par(mfrow = c(1, 1))

```

# 3. Bayesian Model

# 4. Shortcomings and Assumptions

# 5. Conclusion

#6. Appendix

```{r}
#| fig-cap: The difference between inner and outer cell lengths changes root by root
plot_1
```

```{r}
#| fig-cap: There is only slight differences between inner and outer cell lengths
plot_2
```

```{r}
#| fig-cap: MU cells have similar inner vs outer lengths; WT outer has longer lengths than inner
plot_3
```

```{r}
#| fig-cap: Residual plot
print(p2)
```

```{r}
#| fig-cap: Residual plot
print(p3)
```

```{r}
#| fig-cap: Residual plot
print(p4)
```

```{r}
#| fig-cap: Residual plot
print(p5)
```

```{r}
#| fig-cap: Residual plot
print(p6)
```

```{r}
#| fig-cap: Residual plot
print(p_wt)
```

```{r}
#| fig-cap: Residual plot
print(p_mu)
```

```{r}
#| fig-cap: Residual plot
summary(nlme_model)$tTable |>
  kable()
```

---
title: "Case4"
format: html
---

```{r}
#| label: packages

library(tidyverse)
library(knitr)

```

```{r}
#| label: read_data

load("rootData.RData")

```

```{r}
#| label: look_at_data

rootData |>
  count(root, Genotype)

```

```{r}
#| label: start_EDA

rootData |>
  ggplot(aes(x = Midline, y = Length, color = side)) +
    geom_point(alpha = 0.5) +
    geom_smooth(se = FALSE) +
    facet_wrap(~ Genotype) +
    theme_minimal()

rootData |>
  ggplot(aes(x = Midline, y = Length, color = Genotype)) +
    geom_point(alpha = 0.5) +
    geom_smooth(se = FALSE) +
    facet_wrap(~ side) +
    theme_minimal()

rootData |>
  ggplot(aes(x = Midline, y = Length, color = side)) +
    geom_point(alpha = 0.5) +
    geom_smooth(se = FALSE) +
    facet_wrap(~ root) +
    theme_minimal()

```

```{r}
#| label: t_test

delta_root <- rootData |>
  group_by(root, Genotype, side) |>
  summarise(mean_length = mean(Length, na.rm = TRUE), .groups = "drop") |>
  pivot_wider(names_from = side, values_from = mean_length) |>
  mutate(deltaL = Outer - Inner)

delta_root

ggplot(delta_root, aes(x = Genotype, y = deltaL, fill = Genotype)) +
  geom_boxplot(alpha = 0.6, width = 0.4) +
  geom_jitter(width = 0.1, size = 3, color = "black") +
  labs(
    title = "Difference in Mean Cell Length (Outer - Inner) by Genotype",
    y = expression(Delta * L[root]),
    x = "Genotype"
  ) +
  theme_minimal()

t_results <- rootData |>
  group_by(root, Genotype) |>
  summarise(
    t_test = list(t.test(Length ~ side, data = cur_data())),
    .groups = "drop"
  ) |>
  mutate(
    p_value = sapply(t_test, \(x) x$p.value),
    mean_diff = sapply(t_test, \(x) diff(x$estimate))  # outer - inner
  )

t_results

t_summary <- t_results |>
  group_by(Genotype) |>
  summarise(
    mean_delta = mean(mean_diff),
    sd_delta = sd(mean_diff),
    mean_p = mean(p_value),
    sig_roots = sum(p_value < 0.05),
    total_roots = n()
  )

t_summary

ggplot(t_results, aes(x = Genotype, y = mean_diff, color = p_value < 0.05)) +
  geom_point(size = 3) +
  geom_hline(yintercept = 0, linetype = "dashed") +
  labs(
    title = "Per-root Outer vs Inner Differences in Cell Length",
    y = "Mean(Outer) - Mean(Inner)",
    color = "Significant (p < 0.05)"
  ) +
  theme_minimal()

```
```{r}

rootData |>
  filter(Genotype == "WT") |>
  ggplot(aes(x = Midline, y = Length, color = side)) +
    geom_point(alpha = 0.005) + 
    geom_smooth(method = "loess", se = FALSE) +
    facet_wrap(~ root, scales = "free_x") +
    theme_bw() +
    labs(title = "Cell Length Along the Root Midline for Wild Type",
         x = "Distance along root (µm)",
         y = "Cell length (µm)",
         color = "Side of Root") +
  scale_color_manual(values = c("Inner" = "coral", "Outer" = "darkseagreen"))


rootData |>
  filter(Genotype == "MU") |>
  ggplot(aes(x = Midline, y = Length, color = side)) +
    geom_point(alpha = 0.005) + 
    geom_smooth(method = "loess", se = FALSE) +
    facet_wrap(~ root, scales = "free_x") +
    theme_bw() +
    labs(title = "Cell Length Along the Root Midline for Mutant Type",
         x = "Distance along root (µm)",
         y = "Cell length (µm)",
         color = "Side of Root") +
  scale_color_manual(values = c("Inner" = "coral", "Outer" = "darkseagreen"))

ggplot(rootData, aes(x = side, y = Length, fill = side)) +
  geom_boxplot() +
  facet_wrap(~ Genotype) +
  theme_bw() +
  labs(title = "Distribution of Cell Lengths by Genotype and Side",
       x = "Root Side",
       y = "Cell Length (µm)",
       fill = "Side") +
  scale_color_manual(values = c("Inner" = "coral", "Outer" = "darkseagreen"))

ggplot(rootData, aes(x = Length, fill = side)) +
  geom_density(alpha = 0.4) +
  facet_wrap(~ Genotype) +
  theme_bw() +
  labs(title = "Density of Cell Lengths by Side and Genotype",
       x = "Cell Length (µm)",
       y = "Density",
       fill = "Side")
rootData %>%
  group_by(Genotype, side) %>%
  summarize(mean_length = mean(Length, na.rm = TRUE),
            sd_length = sd(Length, na.rm = TRUE),
            n = n())

```

